<mujoco model="biped">
  <compiler angle="radian"/>
  <option timestep="0.002" integrator="RK4" iterations="50" tolerance="1e-8" gravity="0 0 -9.81"/>
  <size njmax="100" nconmax="100"/>

  <visual>
    <map znear="0.0005" zfar="10"/>
  </visual>

  <asset>
    <!-- Scaled meshes (mm → m) -->
    <mesh name="hips" file="meshes/hips.stl" scale="0.001 0.001 0.001"/>
    <mesh name="left_leg" file="meshes/left_leg.stl" scale="0.001 0.001 0.001"/>
    <mesh name="right_leg" file="meshes/right_leg.stl" scale="0.001 0.001 0.001"/>
    <mesh name="left_connectors" file="meshes/left_connectors.stl" scale="0.001 0.001 0.001"/>
    <mesh name="right_connectors" file="meshes/right_connectors.stl" scale="0.001 0.001 0.001"/>
    <mesh name="left_foot" file="meshes/left_foot.stl" scale="0.001 0.001 0.001"/>
    <mesh name="right_foot" file="meshes/right_foot.stl" scale="0.001 0.001 0.001"/>

    <material name="mat_hips" rgba="0.6 0.6 1.0 1"/>
    <material name="mat_leg" rgba="0.5 0.8 1.0 1"/>
    <material name="mat_connector" rgba="1.0 0.6 0.6 1"/>
    <material name="mat_foot" rgba="1.0 0.6 0.9 1"/>
    <texture name="tex_checker" type="2d" builtin="checker"
         width="512" height="512"
         rgb1="0.2 0.2 0.2" rgb2="0.8 0.8 0.8"
         mark="none" markrgb="0 0 0"/>
    <material name="mat_checker" texture="tex_checker" texrepeat="20 20"
        reflectance="0.2" shininess="0.1"/>
  </asset>

  <worldbody>
    <!-- Coordinate axes indicator -->
    <body name="axis_indicator" pos="0 0 0.3">
      <!-- X-axis: red -->
      <geom type="capsule" fromto="0 0 0 0.2 0 0"
            size="0.002"
            rgba="1 0 0 1"
            mass="0"
            density="0"
            contype="0" conaffinity="0"/>

      <!-- Y-axis: green -->
      <geom type="capsule" fromto="0 0 0 0 0.2 0"
            size="0.002"
            rgba="0 1 0 1"
            mass="0"
            density="0"
            contype="0" conaffinity="0"/>

      <!-- Z-axis: blue -->
      <geom type="capsule" fromto="0 0 0 0 0 0.2"
            size="0.002"
            rgba="0 0 1 1"
            mass="0"
            density="0"
            contype="0" conaffinity="0"/>

      <camera name="fixed_cam"
          pos="0.8 0.8 0.3"
          mode="targetbody"
          target="axis_indicator"
          fovy="30"/>
    </body>


    <geom name="floor" type="plane"
          pos="0 0 0"
          size="5 5 0.1"
          material="mat_checker"/>

    <light name="main_light"
      pos="0 0 2"
      dir="0 0 -1"
      diffuse="1 1 1"
      specular="0.5 0.5 0.5"
      mode="trackcom"/>

    <body name="biped" pos="0 0 0.167" euler="0 0 1.5708">
      <joint type="free"/>  <!-- allow full movement in the arena -->
    
      <!-- Hips -->
      <body name="hips" pos="0 0 0">
        <geom type="mesh" mesh="hips" material="mat_hips"/>
        <inertial pos="0.04000000 -0.00551483 -0.00876121" mass="0.19516483" fullinertia="2.79564202e-04 5.41144131e-04 2.76130700e-04 8.70966555e-08 1.50339933e-08 -1.59928592e-05"/>

        <!-- IMU site on hips -->
        <site name="imu_site" pos="0.04 0 0.03" size="0.01" rgba="1 0 0 0"/>

        <camera name="follow_cam"
          pos="1 -0.4 0.05"
          mode="targetbody"
          target="hips"
          fovy="30"/>
        
          <!-- Left side -->
        <body name="left_connectors">
          <joint name="left_hip_joint" type="hinge"
                 pos="-0.031 -0.005 -0.045"
                 axis="1 0 0"
                 range="-1.57 1.57"
                 damping="0.05" armature="0.0002"/>
          <geom type="mesh" mesh="left_connectors" material="mat_connector"/>
          
          <inertial pos="0.00195410 -0.00495223 -0.06998861" mass="0.01407262" fullinertia="5.78383861e-06 1.73463681e-05 1.31149358e-05 2.33004292e-08 1.08133438e-08 -2.04518436e-11"/>

          <body name="left_leg">
            <joint name="left_leg_joint" type="hinge"
                   pos="0.025 -0.005 -0.095"
                   axis="1 0 0"
                   range="-1.57 1.57"
                   damping="0.05" armature="0.0002"/>
            <geom type="mesh" mesh="left_leg" material="mat_leg"/>
            
            <inertial pos="-0.00284265 -0.00694262 -0.10872447" mass="0.06740817" fullinertia="2.58151517e-05 4.34994292e-05 2.42254258e-05 -4.58137877e-07 2.61487615e-06 1.24741306e-06"/>

            <body name="left_foot">
              <joint name="left_foot_joint" type="hinge"
                     pos="0.026 -0.005 -0.153"
                     axis="1 0 0"
                     range="-0.4 0.4"
                     damping="0.05" armature="0.0002"/>
              
              <geom type="mesh" mesh="left_foot" material="mat_foot"/>
              
              <inertial pos="-0.00388570 -0.01480068 -0.15577790" mass="0.06248788" fullinertia="1.60356674e-05 1.61574787e-05 2.58531406e-05 -3.99516485e-07 -4.32592721e-07 -3.43976147e-08"/>
              
              <site name="left_toe"
                type="box"
                pos="-0.005 -0.03 -0.167"
                size="0.025 0.017 0.002"
                rgba="0 1 1 0.4"/>
           
              <site name="left_heel"
                type="box"
                pos="-0.005 0 -0.167"
                size="0.025 0.017 0.002"
                rgba="1 1 0 0.4"/>
            </body>
          </body>
        </body>

        <!-- Right side -->
        <body name="right_connectors">
          <joint name="right_hip_joint" type="hinge"
                 pos="0.031 -0.005 -0.045"
                 axis="1 0 0"
                 range="-1.57 1.57"
                 damping="0.05" armature="0.0002"/>
          <geom type="mesh" mesh="right_connectors" material="mat_connector"/>

          <inertial pos="0.07804590 -0.00500000 -0.07000000" mass="0.01407262" fullinertia="5.78378540e-06 1.73463592e-05 1.31148922e-05 -3.24218404e-15 -1.40416209e-13 9.78755256e-16"/>

          <body name="right_leg">
            <joint name="right_leg_joint" type="hinge"
                   pos="-0.025 -0.005 -0.095"
                   axis="1 0 0"
                   range="-1.57 1.57"
                   damping="0.05" armature="0.0002"/>
            <geom type="mesh" mesh="right_leg" material="mat_leg"/>

            <inertial pos="0.08284265 -0.00694302 -0.10868068" mass="0.06740817" fullinertia="2.58230973e-05 4.35073746e-05 2.42254263e-05 4.58138012e-07 -2.64416437e-06 1.25686164e-06"/>

            <body name="right_foot">
              <joint name="right_foot_joint" type="hinge"
                     pos="0.054 -0.005 -0.153"
                     axis="1 0 0"
                     range="-0.4 0.4"
                     damping="0.05" armature="0.0002"/>

              <geom type="mesh" mesh="right_foot" material="mat_foot"/>

              <inertial pos="0.08388570 -0.01482039 -0.15572569" mass="0.06248788" fullinertia="1.60116521e-05 1.61328146e-05 2.58537897e-05 4.09045390e-07 4.12061741e-07 -3.94227840e-08"/>              

              <site name="right_toe"
                type="box"
                pos="0.085 -0.03 -0.167"
                size="0.025 0.017 0.002"
                rgba="0 1 1 0.4"/>
           
              <site name="right_heel"
                type="box"
                pos="0.085 0 -0.167"
                size="0.025 0.017 0.002"
                rgba="1 1 0 0.4"/>

            </body>
          </body>
        </body>
      </body>
    </body>
  </worldbody>

  <actuator>
    <!-- Left side -->
    <position name="left_hip_act" joint="left_hip_joint"
              kp="50" forcelimited="true" forcerange="-0.3 0.3"
              ctrlrange="-1.57 1.57"/>
    <position name="left_leg_act" joint="left_leg_joint"
              kp="50" forcelimited="true" forcerange="-0.3 0.3"
              ctrlrange="-1.57 1.57"/>
    <position name="left_foot_act" joint="left_foot_joint"
              kp="50" forcelimited="true" forcerange="-0.3 0.3"
              ctrlrange="-0.4 0.4"/>

    <!-- Right side -->
    <position name="right_hip_act" joint="right_hip_joint"
              kp="50" forcelimited="true" forcerange="-0.3 0.3"
              ctrlrange="-1.57 1.57"/>
    <position name="right_leg_act" joint="right_leg_joint"
              kp="50" forcelimited="true" forcerange="-0.3 0.3"
              ctrlrange="-1.57 1.57"/>
    <position name="right_foot_act" joint="right_foot_joint"
              kp="50" forcelimited="true" forcerange="-0.3 0.3"
              ctrlrange="-0.4 0.4"/>
  </actuator>

  <sensor>
    <!-- IMU on hips -->
    <accelerometer name="imu_acc" site="imu_site"/>
    <gyro          name="imu_gyro" site="imu_site"/>

    <!-- Joint angles/velocities (all six leg joints) -->
    <jointpos name="q_left_hip"   joint="left_hip_joint"/>
    <jointpos name="q_left_knee"  joint="left_leg_joint"/>
    <jointpos name="q_left_ankle" joint="left_foot_joint"/>
    <jointvel name="dq_left_hip"   joint="left_hip_joint"/>
    <jointvel name="dq_left_knee"  joint="left_leg_joint"/>
    <jointvel name="dq_left_ankle" joint="left_foot_joint"/>

    <jointpos name="q_right_hip"   joint="right_hip_joint"/>
    <jointpos name="q_right_knee"  joint="right_leg_joint"/>
    <jointpos name="q_right_ankle" joint="right_foot_joint"/>
    <jointvel name="dq_right_hip"   joint="right_hip_joint"/>
    <jointvel name="dq_right_knee"  joint="right_leg_joint"/>
    <jointvel name="dq_right_ankle" joint="right_foot_joint"/>

    <!-- Foot contact “touch” (normal force at each sole) -->
    <touch name="left_toe_contact"  site="left_toe"/>
    <touch name="left_heel_contact"  site="left_heel"/>
    <touch name="right_toe_contact" site="right_toe"/>
    <touch name="right_heel_contact" site="right_heel"/>
  </sensor>

  <contact>
    <exclude body1="hips" body2="left_connectors"/>
    <exclude body1="hips" body2="right_connectors"/>
  </contact>
</mujoco>